# ğŸ—ï¸ Driver Auth - Architecture Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUTTER APPLICATION                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         PRESENTATION LAYER (UI & State)              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  Phone Login Screen                OTP Screen        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ +91 â”‚ 10 digits â”‚          â”‚  4 digits    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ Continue btn     â”‚    â”€â”€â†’   â”‚ Verify btn   â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚           â†‘                            â†‘             â”‚   â”‚
â”‚  â”‚           â”‚                            â”‚             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚      DriverAuthBloc                        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚  (Business Logic & State Management)       â”‚     â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚   â”‚
â”‚  â”‚  â”‚ Bloc listens to Events & emits States      â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ RequestOtpEvent                          â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ VerifyOtpEvent                           â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ ResetAuthEvent                           â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ LogoutEvent                              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ ClearErrorEvent                          â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚           â†“                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           DATA LAYER (Business Rules)                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  DriverAuthRepository (Interface)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ validatePhoneNumber(phone)                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ sendOtp(phone)                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ verifyOtp(phone, otp)                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ completeLogin(phone)                      â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ logout()                                  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚           â†“                                           â”‚   â”‚
â”‚  â”‚  DriverAuthRepositoryImpl (Implementation)           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ Delegates to DriverAuthLocalDataSource      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚           â†“                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚       DATA SOURCE LAYER (Mock Data)                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  DriverAuthLocalDataSource                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ Static Data:                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ allowedDriverPhone = "8123456790"         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ staticOtp = "1234"                        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ Methods (Simulate Network Calls):           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ validatePhoneNumber() â†’ 800ms delay       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ verifyOtp() â†’ 500ms delay                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ completeLogin() â†’ instant                 â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow - Happy Path

```
User Action
   â”‚
   â”œâ”€â†’ [Phone Screen] Enter: 8123456790 â†’ Click Continue
   â”‚   â”‚
   â”‚   â”œâ”€â†’ Event: RequestOtpEvent('8123456790')
   â”‚   â”‚
   â”‚   â”œâ”€â†’ Bloc Receives Event
   â”‚   â”‚   â”œâ”€ Validate format (10 digits) âœ“
   â”‚   â”‚   â”œâ”€ Validate format (numeric) âœ“
   â”‚   â”‚   â”œâ”€ Call repository.validatePhoneNumber()
   â”‚   â”‚   â”œâ”€ Datasource check: 8123456790 == 8123456790 âœ“
   â”‚   â”‚   â””â”€ Emit State: OtpWaitingState
   â”‚   â”‚
   â”‚   â””â”€â†’ [OTP Screen] (auto-navigate)
   â”‚
   â”œâ”€â†’ [OTP Screen] Enter: 1234 â†’ Click Verify OTP
   â”‚   â”‚
   â”‚   â”œâ”€â†’ Event: VerifyOtpEvent(phoneNumber, otp: '1234')
   â”‚   â”‚
   â”‚   â”œâ”€â†’ Bloc Receives Event
   â”‚   â”‚   â”œâ”€ Validate format (4 digits) âœ“
   â”‚   â”‚   â”œâ”€ Validate format (numeric) âœ“
   â”‚   â”‚   â”œâ”€ Call repository.verifyOtp('8123456790', '1234')
   â”‚   â”‚   â”œâ”€ Datasource check: '1234' == '1234' âœ“
   â”‚   â”‚   â”œâ”€ Call repository.completeLogin()
   â”‚   â”‚   â”œâ”€ Get authToken: 'mock_token_8123456790'
   â”‚   â”‚   â””â”€ Emit State: DriverAuthenticatedState
   â”‚   â”‚
   â”‚   â””â”€â†’ [Driver Home] (auto-navigate)
   â”‚
   â””â”€â†’ âœ… User Authenticated

âœ… Total States Emitted: 5
   1. PhoneNumberWaitingState
   2. PhoneNumberValidatingState
   3. OtpWaitingState
   4. OtpVerifyingState
   5. DriverAuthenticatedState
```

---

## Data Flow - Error Path (Invalid Phone)

```
User Action
   â”‚
   â””â”€â†’ [Phone Screen] Enter: 9876543210 â†’ Click Continue
       â”‚
       â”œâ”€â†’ Event: RequestOtpEvent('9876543210')
       â”‚
       â”œâ”€â†’ Bloc Receives Event
       â”‚   â”œâ”€ Validate format (10 digits) âœ“
       â”‚   â”œâ”€ Validate format (numeric) âœ“
       â”‚   â”œâ”€ Call repository.validatePhoneNumber()
       â”‚   â”œâ”€ Datasource check: 9876543210 != 8123456790 âœ—
       â”‚   â””â”€ Emit State: PhoneNumberErrorState('Unauthorized Driver...')
       â”‚
       â””â”€â†’ [Phone Screen] Show Error
           â””â”€â†’ User can retry

âŒ Total States Emitted: 3
   1. PhoneNumberWaitingState
   2. PhoneNumberValidatingState
   3. PhoneNumberErrorState
```

---

## State Machine Diagram

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ DriverAuthInitial       â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ PhoneNumberWaitingState      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚PhoneNumberValidating â”‚  â”‚ PhoneNumberErrorStateâ”‚
        â”‚State                 â”‚  â”‚ (non-authorized)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                   â”‚                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   [Retry]
        â†“                     â†“                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Valid?  â”‚  
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  
         â”‚       
         â”œâ”€ YES â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚          â”‚ OtpWaitingState     â”‚
         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚
         â”‚                   â†“
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        â”‚ OtpVerifyingState    â”‚
         â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚
         â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      â†“                     â†“
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  â”‚ Valid?  â”‚   â”‚ OtpErrorState        â”‚
         â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚ (invalid OTP)        â”‚
         â”‚       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚       â”‚                 â”‚
         â”‚       â”œâ”€ YES â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚       â”‚          â”‚ DriverAuthenticated â”‚
         â”‚       â”‚          â”‚ State âœ…             â”‚
         â”‚       â”‚          â”‚ (Navigate Home)     â”‚
         â”‚       â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚       â”‚
         â”‚       â””â”€ NO â”€â”€â”€â”€â”€â”€â”€â”€[Retry]â”€â”€â”€â”€â”€â”€â”
         â”‚                                   â”‚
         â””â”€â”€[Logout from any state]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â†’ DriverUnauthenticatedState
```

---

## Event-State Mapping

```
Event                          â†’ Bloc Processing           â†’ State Emitted

RequestOtpEvent
â”œâ”€ phoneNumber: String        â†’ Format validation        â†’ PhoneNumberValidatingState
â”‚                              â†’ Auth check with DB      â†’ PhoneNumberErrorState
â”‚                              â†’ Send OTP (simulated)     â†’ OtpWaitingState

VerifyOtpEvent
â”œâ”€ phoneNumber: String        â†’ Format validation        â†’ OtpVerifyingState
â””â”€ otp: String                â†’ OTP verification         â†’ OtpErrorState
                               â†’ Complete login          â†’ DriverAuthenticatedState

ResetAuthEvent
â””â”€ (no data)                  â†’ Clear state              â†’ DriverAuthInitial

LogoutEvent
â””â”€ (no data)                  â†’ Clear auth data          â†’ DriverUnauthenticatedState

ClearErrorEvent
â””â”€ (no data)                  â†’ Dismiss error            â†’ PhoneNumberWaitingState
                                                          or OtpWaitingState
```

---

## Validation Flow

```
Phone Input: "8123456790"
â”‚
â”œâ”€ Length Check
â”‚  â”œâ”€ Is length == 10?
â”‚  â”œâ”€ YES â†’ Continue
â”‚  â””â”€ NO â†’ PhoneNumberErrorState("Phone number must be exactly 10 digits")
â”‚
â”œâ”€ Format Check
â”‚  â”œâ”€ Is all numeric (0-9)?
â”‚  â”œâ”€ YES â†’ Continue
â”‚  â””â”€ NO â†’ PhoneNumberErrorState("Phone number must contain only digits")
â”‚
â”œâ”€ Authorization Check
â”‚  â”œâ”€ Call repository.validatePhoneNumber('8123456790')
â”‚  â”œâ”€ Datasource: Compare with '8123456790'
â”‚  â”œâ”€ Match Found â†’ Send OTP
â”‚  â””â”€ No Match â†’ PhoneNumberErrorState("Unauthorized Driver. Please contact support.")
â”‚
â””â”€ Success
   â””â”€ OtpWaitingState (Show OTP Screen)


OTP Input: "1234"
â”‚
â”œâ”€ Length Check
â”‚  â”œâ”€ Is length == 4?
â”‚  â”œâ”€ YES â†’ Continue
â”‚  â””â”€ NO â†’ OtpErrorState("OTP must be exactly 4 digits")
â”‚
â”œâ”€ Format Check
â”‚  â”œâ”€ Is all numeric (0-9)?
â”‚  â”œâ”€ YES â†’ Continue
â”‚  â””â”€ NO â†’ OtpErrorState("OTP must contain only digits")
â”‚
â”œâ”€ Verification Check
â”‚  â”œâ”€ Call repository.verifyOtp('8123456790', '1234')
â”‚  â”œâ”€ Datasource: Compare with '1234'
â”‚  â”œâ”€ Match Found â†’ Complete Login
â”‚  â””â”€ No Match â†’ OtpErrorState("Invalid OTP. Please try again.")
â”‚
â””â”€ Success
   â””â”€ DriverAuthenticatedState (Navigate Home)
```

---

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DriverAuthBloc     â”‚ (Event Handler)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ calls
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DriverAuthRepository (Interface)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  validatePhoneNumber(phone)          â”‚
â”‚  sendOtp(phone)                      â”‚
â”‚  verifyOtp(phone, otp)               â”‚
â”‚  completeLogin(phone)                â”‚
â”‚  logout()                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ implemented by
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DriverAuthRepositoryImpl              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Uses: DriverAuthLocalDataSource      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ delegates to
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DriverAuthLocalDataSource (Mock)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ allowedDriverPhone: "8123456790"     â”‚
â”‚ staticOtp: "1234"                    â”‚
â”‚ (Simulates network with delays)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Dependency Injection Flow

```
bootstrap()
   â”‚
   â”œâ”€â†’ setupServiceLocator()
   â”‚   â”‚
   â”‚   â”œâ”€â†’ _setupCore()
   â”‚   â”‚   â”œâ”€ Register DioClient
   â”‚   â”‚   â””â”€ Register TokenManager
   â”‚   â”‚
   â”‚   â””â”€â†’ _setupDriverAuth()
   â”‚       â”œâ”€ Register DriverAuthLocalDataSource
   â”‚       â”œâ”€ Register DriverAuthRepository (using datasource)
   â”‚       â””â”€ Register DriverAuthBloc (using repository)
   â”‚
   â””â”€â†’ runApp(EchoApp())
       â”‚
       â””â”€â†’ MultiBlocProvider
           â”œâ”€ BlocProvider<DriverAuthBloc>(
           â”‚   create: (_) => getIt<DriverAuthBloc>()
           â”‚ )
           â””â”€ [Other blocs...]

When navigating to /driver-login:
   â”‚
   â””â”€â†’ AppRoutes.onGenerateRoute()
       â”‚
       â””â”€â†’ BlocProvider<DriverAuthBloc>(
           create: (_) => getIt<DriverAuthBloc>()
       )
           â”‚
           â””â”€â†’ DriverPhoneLoginScreen()
```

---

## Clean Architecture Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PRESENTATION LAYER (UI)                      â”‚
â”‚                                                        â”‚
â”‚  â€¢ DriverPhoneLoginScreen                             â”‚
â”‚  â€¢ OtpVerificationScreen                              â”‚
â”‚  â€¢ DriverAuthBloc                                     â”‚
â”‚  â€¢ DriverAuthEvent                                    â”‚
â”‚  â€¢ DriverAuthState                                    â”‚
â”‚                                                        â”‚
â”‚  RESPONSIBILITY: React to state changes, emit events  â”‚
â”‚  RULE: No business logic, no repository access       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATA LAYER (Business Rules)                â”‚
â”‚                                                        â”‚
â”‚  â€¢ DriverAuthRepository (Interface)                   â”‚
â”‚  â€¢ DriverAuthRepositoryImpl                           â”‚
â”‚  â€¢ DriverAuthLocalDataSource                         â”‚
â”‚  â€¢ DriverAuthEntity                                  â”‚
â”‚                                                        â”‚
â”‚  RESPONSIBILITY: Implement business rules, access    â”‚
â”‚  RULE: Independent of presentation, reusable         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DOMAIN LAYER (Contracts)                    â”‚
â”‚                                                        â”‚
â”‚  â€¢ DriverAuthRepository (Interface)                   â”‚
â”‚  â€¢ DriverAuthEntity (Data model)                      â”‚
â”‚                                                        â”‚
â”‚  RESPONSIBILITY: Define what should happen            â”‚
â”‚  RULE: No implementation details, pure interfaces     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
âœ… Easy to test (mock repository)
âœ… Easy to swap (change datasource)
âœ… Easy to reuse (any UI can use)
âœ… Easy to maintain (single responsibility)
```

---

## Mock Data Lifecycle

```
App Start
   â”‚
   â””â”€â†’ DriverAuthLocalDataSource is registered
       â”‚
       â””â”€â†’ Contains static data:
           â”œâ”€ allowedDriverPhone = "8123456790"
           â”œâ”€ staticOtp = "1234"
           â”œâ”€ mockAuthToken = "mock_token_8123456790"
           â”‚
           â””â”€ Simulates network calls with delays:
              â”œâ”€ validatePhoneNumber() â†’ wait 800ms
              â””â”€ verifyOtp() â†’ wait 500ms

During Login Flow
   â”‚
   â”œâ”€â†’ User enters "8123456790"
   â”‚   â””â”€â†’ datasource.validatePhoneNumber('8123456790')
   â”‚       â””â”€â†’ Compare with allowedDriverPhone âœ“
   â”‚
   â””â”€â†’ User enters "1234"
       â””â”€â†’ datasource.verifyOtp('8123456790', '1234')
           â””â”€â†’ Compare with staticOtp âœ“

App Restart
   â”‚
   â””â”€â†’ All data cleared
       â””â”€â†’ Auth state resets
           â””â”€â†’ PhoneNumberWaitingState again
```

---

## Security Model (Current - Mock)

```
Current Flow (Development):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client-Side Only            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phone: 8123456790          â”‚
â”‚ OTP: 1234                  â”‚
â”‚ No server validation       â”‚
â”‚ No token generation        â”‚
â”‚ No persistence             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
âœ… Good for testing
âŒ Not production ready

Production Flow (Future):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Requests Phone       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Validates Phone      â”‚
â”‚ Sends Real SMS OTP          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Enters OTP           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Verifies OTP         â”‚
â”‚ Issues Auth Token           â”‚
â”‚ Client Stores Securely      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Authenticated        â”‚
â”‚ Token Used for API Calls    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Version**: 1.0.0  
**Status**: âœ… Complete  
**Updated**: January 12, 2026
